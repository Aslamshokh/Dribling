<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dribbling - –ü—Ä–æ—Ñ–∏–ª—å</title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="header">
        <div class="header-title">–ü—Ä–æ—Ñ–∏–ª—å</div>
        <div>
            <a href="/leaderboard.html" style="color: var(--accent-green);">
                <i class="fas fa-trophy"></i> –†–µ–π—Ç–∏–Ω–≥
            </a>
        </div>
    </div>

    <div class="container">
        <!-- Profile Info -->
        <div class="profile-header">
            <img id="profile-photo" src="" alt="Profile" class="profile-avatar">
            <h2 id="profile-name" class="profile-name"></h2>
            <div id="profile-username" class="profile-username"></div>
        </div>

        <!-- Stats -->
        <div class="profile-stats">
            <div class="stat-card">
                <div class="stat-value" id="stat-rating">0</div>
                <div class="stat-label">–†–µ–π—Ç–∏–Ω–≥</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="stat-matches">0</div>
                <div class="stat-label">–ò–≥—Ä</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="stat-wins">0</div>
                <div class="stat-label">–ü–æ–±–µ–¥</div>
            </div>
        </div>

        <!-- History Tabs -->
        <div style="margin-bottom: 16px;">
            <div class="filters" style="justify-content: center;">
                <span class="filter-chip active" data-status="all">–í—Å–µ</span>
                <span class="filter-chip" data-status="open">–ê–∫—Ç–∏–≤–Ω—ã–µ</span>
                <span class="filter-chip" data-status="finished">–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ</span>
            </div>
        </div>

        <!-- Match History -->
        <div id="match-history">
            <div class="loading">
                <div class="loading-spinner"></div>
            </div>
        </div>

        <!-- Navigation -->
        <div style="margin-top: 24px; text-align: center;">
            <a href="/map.html" class="btn btn-outline" style="margin-right: 8px;">
                <i class="fas fa-map"></i> –ö–∞—Ä—Ç–∞
            </a>
            <a href="/history.html" class="btn btn-outline">
                <i class="fas fa-history"></i> –í—Å—è –∏—Å—Ç–æ—Ä–∏—è
            </a>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="/profile.html" class="nav-item active">
            <i class="fas fa-user"></i>
            <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
        </a>
        <a href="/matches.html" class="nav-item">
            <i class="fas fa-futbol"></i>
            <span>–ú–∞—Ç—á–∏</span>
        </a>
        <a href="/create-match.html" class="nav-item">
            <i class="fas fa-plus-circle"></i>
            <span>–°–æ–∑–¥–∞—Ç—å</span>
        </a>
    </nav>

    <script src="/js/app.js"></script>
    <script src="/js/api.js"></script>
    <script>
        let currentStatus = 'all';

        document.addEventListener('DOMContentLoaded', async () => {
            await loadProfile();
            await loadMatchHistory();
            setupFilters();
        });

        async function loadProfile() {
            try {
                const user = await api.getCurrentUser();
                
                document.getElementById('profile-photo').src = user.photo_url || 'https://via.placeholder.com/100';
                document.getElementById('profile-name').textContent = user.first_name;
                document.getElementById('profile-username').textContent = user.username ? `@${user.username}` : '';
                
                document.getElementById('stat-rating').textContent = user.rating;
                document.getElementById('stat-matches').textContent = user.matches_played;
                document.getElementById('stat-wins').textContent = user.wins;
            } catch (error) {
                console.error('Error loading profile:', error);
            }
        }

        function setupFilters() {
            document.querySelectorAll('[data-status]').forEach(chip => {
                chip.addEventListener('click', () => {
                    document.querySelectorAll('[data-status]').forEach(c => c.classList.remove('active'));
                    chip.classList.add('active');
                    currentStatus = chip.dataset.status;
                    loadMatchHistory();
                });
            });
        }

        async function loadMatchHistory() {
            const container = document.getElementById('match-history');
            container.innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';

            try {
                const user = await api.getCurrentUser();
                const matches = await api.getUserMatches(user.id, currentStatus);
                
                if (matches.length === 0) {
                    container.innerHTML = '<p class="text-center" style="color: var(--text-secondary);">–ò—Å—Ç–æ—Ä–∏—è –º–∞—Ç—á–µ–π –ø—É—Å—Ç–∞</p>';
                    return;
                }

                container.innerHTML = '';
                matches.slice(0, 5).forEach(match => {
                    const matchCard = document.createElement('div');
                    matchCard.className = 'card match-card';
                    matchCard.onclick = () => navigateTo(`/match-detail.html?id=${match.id}`);
                    
                    const statusText = match.status === 'finished' ? '–ó–∞–≤–µ—Ä—à–µ–Ω' : 
                                      match.status === 'open' ? '–û—Ç–∫—Ä—ã—Ç' : '–ó–∞–ø–æ–ª–Ω–µ–Ω';
                    
                    matchCard.innerHTML = `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-weight: 600;">${match.title}</span>
                            <span style="color: var(--accent-green);">${statusText}</span>
                        </div>
                        <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px;">
                            <i class="fas fa-calendar"></i> ${formatDate(match.date_time)}
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>üë• ${match.players_count}/${match.max_players}</span>
                            <span>üèü ${match.stadium}</span>
                        </div>
                    `;
                    
                    container.appendChild(matchCard);
                });

                if (matches.length > 5) {
                    const showMore = document.createElement('div');
                    showMore.className = 'text-center mt-4';
                    showMore.innerHTML = '<a href="/history.html" class="btn btn-outline btn-small">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ</a>';
                    container.appendChild(showMore);
                }
            } catch (error) {
                console.error('Error loading history:', error);
                container.innerHTML = '<p class="text-center text-green">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏</p>';
            }
        }
    </script>
</body>
</html>