<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dribbling - –ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="header">
        <div class="header-title">–ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä</div>
        <div>
            <i class="fas fa-history" style="color: var(--accent-green);"></i>
        </div>
    </div>

    <div class="container">
        <div class="filters" style="justify-content: center;">
            <span class="filter-chip active" data-status="all">–í—Å–µ</span>
            <span class="filter-chip" data-status="finished">–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ</span>
            <span class="filter-chip" data-status="cancelled">–û—Ç–º–µ–Ω–µ–Ω–Ω—ã–µ</span>
        </div>

        <div id="history-list">
            <div class="loading">
                <div class="loading-spinner"></div>
            </div>
        </div>
    </div>

    <nav class="bottom-nav">
        <a href="profile.html" class="nav-item">
            <i class="fas fa-user"></i>
            <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
        </a>
        <a href="matches.html" class="nav-item">
            <i class="fas fa-futbol"></i>
            <span>–ú–∞—Ç—á–∏</span>
        </a>
        <a href="create-match.html" class="nav-item">
            <i class="fas fa-plus-circle"></i>
            <span>–°–æ–∑–¥–∞—Ç—å</span>
        </a>
    </nav>

    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/app.js"></script>
    <script>
        let currentStatus = 'all';

        document.addEventListener('DOMContentLoaded', async () => {
            setupFilters();
            await loadHistory();
        });

        function setupFilters() {
            document.querySelectorAll('[data-status]').forEach(chip => {
                chip.addEventListener('click', () => {
                    document.querySelectorAll('[data-status]').forEach(c => c.classList.remove('active'));
                    chip.classList.add('active');
                    currentStatus = chip.dataset.status;
                    loadHistory();
                });
            });
        }

        async function loadHistory() {
            const container = document.getElementById('history-list');
            container.innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';

            try {
                const user = await api.getCurrentUser();
                const matches = await api.getUserMatches(user.id, currentStatus);
                
                if (matches.length === 0) {
                    container.innerHTML = '<p class="text-center" style="color: var(--text-secondary);">–ò—Å—Ç–æ—Ä–∏—è –º–∞—Ç—á–µ–π –ø—É—Å—Ç–∞</p>';
                    return;
                }

                container.innerHTML = '';
                
                matches.sort((a, b) => new Date(b.date_time) - new Date(a.date_time));
                
                matches.forEach(match => {
                    const matchCard = document.createElement('div');
                    matchCard.className = 'card match-card';
                    matchCard.onclick = () => navigateTo(`match-detail.html?id=${match.id}`);
                    
                    const statusText = match.status === 'finished' ? '–ó–∞–≤–µ—Ä—à–µ–Ω' : 
                                      match.status === 'cancelled' ? '–û—Ç–º–µ–Ω–µ–Ω' : 
                                      match.status === 'open' ? '–û—Ç–∫—Ä—ã—Ç' : '–ó–∞–ø–æ–ª–Ω–µ–Ω';
                    
                    const statusColor = match.status === 'finished' ? 'var(--accent-green)' : 
                                       match.status === 'cancelled' ? '#ff4444' : 
                                       'var(--text-secondary)';
                    
                    matchCard.innerHTML = `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-weight: 600;">${match.title}</span>
                            <span style="color: ${statusColor};">${statusText}</span>
                        </div>
                        <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px;">
                            <i class="fas fa-calendar"></i> ${formatDate(match.date_time)}
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 14px;">
                            <span>üèü ${match.stadium}</span>
                            <span>üìç ${match.city}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--border-color);">
                            <span>üë• ${match.players_count || 0}/${match.max_players}</span>
                            <span>üìä ${match.format}</span>
                        </div>
                    `;
                    
                    container.appendChild(matchCard);
                });
            } catch (error) {
                console.error('Error loading history:', error);
                container.innerHTML = '<p class="text-center text-green">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏</p>';
            }
        }
    </script>
</body>
</html>